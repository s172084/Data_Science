---
title: "Lab4"
author: "Oriade Latifah Simpson"
date: "18/03/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r warning=FALSE}
library(fs)
library(tidyverse)
library(readr)
library(magrittr)
library(viridisLite)
library(ggthemes)
library(patchwork)
```

Knit = command + shift + k
Run = command + enter
Pipe = command + shift + m 
New chunk = command + option + i 

Grouping and Summarizing = <https://youtu.be/zAlbrPozMHI> 

```{r}
# create a tibble called x
tibble(x = c(4,3,5,1,2))
```

**Q1:**
**Filter for all of the numbers that are larger than 2.
```{r}
tibble(x = c(4,3,5,1,2)) %>% filter (x > 2)
```

**Q2:** Arrange from the smallest to the largest number.
```{r}
tibble(x = c(4,3,5,1,2)) %>%  arrange(x)
```

**Q3:**
Arrange the numbers in descending order. 
```{r}
tibble(x = c(4,3,5,1,2)) %>% arrange(desc(x))
```
**Q4:**
Arrange from the smallest to the largest number. 
```{r}
tibble(x = c(4,3,5,1,2)) %>% arrange(desc(desc(x)))
```
**Q5:**
Create two tibbles and select the one called x. 
```{r}
tibble(x = c(4,3,5,1,2), y = c(2,4,3,5,1)) %>% select(x)
```
**Q6:**
Create two tibbles and select the one called y. 
```{r}
tibble(x = c(4,3,5,1,2),  y = c(2,4,3,5,1)) %>% select(y)
```
**Q7:**
Dont include the x tibble when selecting tibbles.

```{r}
tibble(x = c(4,3,5,1,2),  y = c(2,4,3,5,1)) %>%  select(-x) 
```
**Q8:**
Don't include any of the tibbles in the output. 
```{r}
tibble(x = c(4,3,5,1,2),  y = c(2,4,3,5,1)) %>% select(-x, -y)
```
**Q9:**
Create a new column called x_dbl which is double the first column. 
```{r}
tibble(x = c(4,3,5,1,2)) %>% mutate(x_dbl = 2*x)
```
**Q10:**
Create two additional columns using mutate. 
```{r}
tibble(x = c(4,3,5,1,2)) %>% 
  mutate (x_dbl = 2 * x, x_qdr = 2*x_dbl)
```
**Q11:**
Find the mean of the column.
```{r}
tibble(x = c(4,3,5,1,2)) %>% summarise(x_mu = mean(x))
```
**Q12:**
Find the maximum value of the column.
```{r}
tibble(x = c(4,3,5,1,2)) %>% summarise(x_max = max(x))
```

**Q13:**

Create two columns called lbl and x.
and then group the columns by the label. 
and find the mean and the max of the column called X, based on the label. 

```{r}
tibble(lbl = c("A", "A", "B", "B", "C"), 
       x = c(4, NA, 5,1,2))%>%
  group_by(lbl) %>% 
  summarise(x_mu = mean(x), x_max = max(x))
```

**Q14:**

Count how many letters are in the label column. 

```{r}
tibble(lbl = c("A", "A", "B", "B", "C"), 
       x = c(4, 3, 5,1,2)) %>%
  group_by(lbl) %>% 
  summarise(n = n())
```

**Q15:**

Count how many letters are in the label column.
This is the shorthand of group_by and summarize. 

```{r}
tibble(lbl = c("A", "A", "B", "B", "C"), 
       x = c(4, 3, 5,1,2)) %>%
  count(lbl)
```

### Load Data
Vanderbilt Biostatistics Datasets 

Diabetes Dataset

These data are courtesy of Dr John Schorling, Department of Medicine, University of Virginia School of Medicine.
The data consist of 19 variables on 403 subjects from 1046 subjects who were interviewed in a study to understand the prevalence of obesity, diabetes, and other cardiovascular risk factors in central Virginia for African Americans. 

According to Dr John Hong, Diabetes Mellitus Type II (adult onset diabetes) is associated most strongly with obesity.
The waist/hip ratio may be a predictor in diabetes and heart disease. DM II is also agssociated with hypertension - they may both be part of "Syndrome X". The 403 subjects were the ones who were actually screened for diabetes. Glycosolated hemoglobin > 7.0 is usually taken as a positive diagnosis of diabetes. For more information about this study see 

Willems JP, Saunders JT, DE Hunt, JB Schorling: Prevalence of coronary heart disease risk factors among rural blacks: A community-based study. Southern Medical Journal 90:814-820; 1997 

and

Schorling JB, Roach J, Siegel M, Baturka N, Hunt DE, Guterbock TM, Stewart HL: A trial of church-based smoking cessation interventions for rural African Americans. Preventive Medicine 26:92-101; 1997.


```{r}
diabetes_data <- readr::read_csv(file = "data/diabetes.csv", na = "NA")
diabetes_data
```
Alternatively download and create the folder....

```{r echo=TRUE, eval=FALSE}
# Create the data directory programmatically
dir_create(path = "data")

# Retrieve the data directly
diabetes_data <- read_csv(file = "https://hbiostat.org/data/repo/diabetes.csv")

# Write the data to disk
write_csv(x = diabetes_data, file = "data/diabetes.csv")
```

### Work with the diabetes data set

**Q1: How many observations and how may variables? **
```{r}
dim(diabetes_data)
```

There are 403 (observations) rows and 19 (variables) columns. 


**Q2: Is this a tidy dataset? Which three rules must be satisfied?**
Yes. The variables are in columns, The observations are in rows and the values are in cells.  

```{r}
head(diabetes_data)
```

**Q3: When you run the chunk then underneath each column name is stated <chr> and <dbl> what is that?**
<chr> means this is a character vector
<dble> means this is a vector of doubles. 

**T1: Change the height, weight, waist and hip from inches pounds to the metric system (cm/kg), rounding to 1 decimal.**

```{r}
diabetes_data_t1 <- diabetes_data %>% 
  mutate(height_cm = round((height * 2.54), digits = 2),
         weight_kg = round((weight / 2.20), digits = 2),
         waist_cm = waist * 2.54,
         hip_cm = hip * 2.54,
         height_metres = height_cm /100)

diabetes_data_t1
```

**Q4: How many weigh less than 100kg?**
There are 345 people. 
```{r}
diabetes_data_t1 %>% 
  filter(weight_kg < 100 & weight_kg != "NA")
```

**Q5: How many weigh more than 100kg?**
There are 53 people. 
```{r}
diabetes_data_t1 %>% 
  filter(weight_kg > 100 & weight_kg != "NA")
```

**Q6: How many weigh more than 100kg and are less than 1.6m tall?**
There are two people. 
```{r}
diabetes_data_t1 %>% 
  filter(weight_kg > 100 & height_metres < 1.60 )

```

**Q7: How many women are taller than 1.8m?**

There are four women. 

```{r}
diabetes_data_t1 <- diabetes_data_t1 %>% 
  # turn gender into a factor. 
  mutate(gender = factor(gender))


diabetes_data_t1  %>% 
  filter(gender == "female", height_metres > 1.80)
  
```

**Q8: How many men are taller than 1.8m?**
There are 51 men. 

```{r}
diabetes_data_t1  %>% 
  filter(gender == "male", height_metres > 1.80)
```

**Q9: How many women in Louisa are older than 30?**

There are 95 women. 
```{r}
diabetes_data_t1  %>% 
  filter(gender == "female",
         age > 30,
         location =="Louisa")

```

**Q10: How many men in Buckingham are younger than 30 and taller than 1.9m?**
There is one man and he is a tall 23 year old. 

```{r}
diabetes_data_t1  %>% 
  filter(gender == "male",
         age < 30,
         location =="Buckingham", 
         height_metres > 1.90)
```
**T2: Make a scatter plot of weight versus height and colour by gender for inhabitants of Louisa above the age of 40**
```{r}
diabetes_data_t1  %>% 
  filter(age > 40,
         location =="Louisa") %>% 
  ggplot(mapping = aes(weight,height, fill = gender))+
  geom_point(colour = "black", alpha = 0.7, pch = 21)+
  # Add colour to points 
   #scale_color_manual(values=c('Yellow','darkgreen'))+
   scale_fill_brewer(palette="Accent")+
  theme(
    legend.position = "bottom",
  )+
  labs(
    title = "Title: A scatter plot of weight versus height",
    subtitle = "The inhabitants of Louisa above the age of 40",
    x = "weight",
    y = "height",
    caption = "Data from Vanderbilt Biostatistics Datasets"
  )
 

```


**T3: Make a boxplot of height versus location stratified on gender for people above the age of 50**
```{r}
diabetes_data_t1  %>% 
  filter(age > 50) %>% 
  ggplot(mapping = aes(x = height, y = location, fill = gender))+
  geom_boxplot(colour = "black", alpha = 0.7)+
  scale_fill_brewer(palette="Accent")+
  facet_wrap(~ gender)+
   theme(
    legend.position = "bottom",
  )+
  labs(
    title = "Title: A box plot of height versus location",
    subtitle = "The inhabitants of Louisa above the age of 50",
    x = "height",
    y = "location",
    caption = "Data from Vanderbilt Biostatistics Datasets"
  )
 

```

Sorting columns can aid in getting an overview of variable ranges.
Don't use the summary function not yet for this one.


**Q11: How old is the youngest person?**
The youngest person in 19 years old. 
```{r}
diabetes_data_t1 %>% arrange(age)
```
 
command + shift + m for pipes
 

**Q12: How old is the oldest person?**
The oldest person is 92. 
```{r}
diabetes_data_t1 %>% arrange(desc(age))
```

**Q13: Of all the 20-year olds, what is the height of the tallest?**
The tallest 20 year old person is 1.82 metres
```{r}
diabetes_data_t1 %>%
  filter(age == 20) %>% 
  arrange(desc(height))
```

**Q14: Of all the 20-year olds, what is the height of the shortest?**
The shortest person is 1.473 
```{r}
diabetes_data_t1 %>%
  filter(age == 20) %>% 
  arrange(height_metres)
```

**Q15: How many columns (variables) starts_with a “b”?**
There are four columns start start with a b. 
```{r}
diabetes_data_t1 %>% select(starts_with('b'))
```

**Q16: How many columns (variables) contains the word “eight”?**
There are 5 variables (now), that contain the word 'eight'
```{r}
diabetes_data_t1 %>% select(contains('eight'))

```

**T4: Create a new variable, where you calculate the BMI**
```{r}
diabetes_data_t1 <- diabetes_data_t1 %>%
  mutate(bmi = round(weight_kg / (height_metres ^ 2), digits = 1))

diabetes_data_t1
```

```{r}
# This is the example.

tibble(x = rnorm(100)) %>% 
  mutate(trichotomised = case_when(x < -1 ~ "Less than -1",
                                   -1 <= x & x < 1 ~ "larger than or equal to -1 and smaller than 1",
                                   1 <= x ~ "Larger than or equal to 1"))
```

**T5: Create a BMI_class variable**

```{r}
diabetes_data_t1 <- diabetes_data_t1 %>% 
  mutate(BMI_class = case_when( bmi <= 18.5 ~ "Underweight",
                                 18.6 <= bmi & bmi <= 24.9 ~ "Normal Weight",
                                 25.0 <= bmi & bmi <= 29.9 ~ "Overweight",
                                 30.0 <= bmi & bmi <= 34.9 ~ "Obese",
                                 35.0 <= bmi & bmi <=  39.9 ~ "Severe Obesity",
                                 40.0 <= bmi & bmi <= 49.9 ~ "Morbid Obesity",
                                 50.0 <= bmi & bmi <= 60.0  ~ "Extreme Obesity"))

# Convert it to a factor and set the levels. 
diabetes_data_t1<- diabetes_data_t1 %>%
  mutate(BMI_class = factor(BMI_class,
                            levels =  c("Underweight",
                                        "Normal Weight",
                                        "Overweight",
                                        "Obese",
                                        "Severe Obesity", 
                                        "Morbid Obesity",
                                        "Extreme Obesity")))

diabetes_data_t1
```

**T6: Create a boxplot of hdl versus BMI_class**
```{r}
diabetes_data_t1 %>% 
  # filter out the BMI class. 
  filter(!is.na(BMI_class)) %>% 
  ggplot(mapping = aes(x = hdl, y = BMI_class, fill = BMI_class))+
  geom_boxplot(colour = "black", alpha = 0.3, na.rm = TRUE)+
  scale_fill_brewer(palette="Accent")+
   theme(
    legend.position = "bottom",
  )+
  labs(
    title = "Title: A box plot of High Density Lipoprotein versus BMI classification",
    x = "High Density Lipoprotein",
    y = "BMI class",
    caption = "Data from Vanderbilt Biostatistics Datasets"
  )

```


**Q17: What do you see?**
There is a large distribution of people who have a normal weight. 


**T7: Create a body fat percentage variable**
```{r}
diabetes_data_t1 <- diabetes_data_t1 %>% 
   mutate(gender_class = case_when( gender == "female" ~ 0,
                                    gender == "male" ~ 1))


diabetes_data_t1 
```
```{r}
diabetes_data_t1 <- diabetes_data_t1 %>% 
  mutate(body_fat_percentage = ((1.39 * bmi) + (0.16* age) - (10.34 * gender_class) - 9))
```


**T8: Create a WHR (waist-to-hip ratio) variable**
```{r}
diabetes_data_t1 <- diabetes_data_t1 %>% 
  mutate(waist_to_hip_ratio = round((waist_cm/ hip_cm), digits = 2))
```


**Q18: Which correlate better with BMI, WHR or BFP?**
```{r}
# drop the na values. 
drop_na(diabetes_data_t1) %$%
  cor(bmi, waist_to_hip_ratio) 


drop_na(diabetes_data_t1) %$% 
  cor(bmi, body_fat_percentage)

cat("Can you perhaps use an R-function to compute the “correlation coefficient”?.")
cat("The correlation for bmi and waist to hip ratio is -0.08", "\n")

cat("The correlation for bmi and body fat percentage is 0.88")

```


```{r}
# Get 3 rows of data sampled randomly. 
diabetes_data_t1 %>% sample_n(3)
```
* Plot the relationship between bmi and waist to hip ratio

```{r}
pl1 <- diabetes_data_t1 %>%
  ggplot(aes(x = bmi, y = waist_to_hip_ratio, fill = bmi)) +
  geom_point(colour = "black", alpha = 0.7, pch = 21)+
  # fill with a continuous colour. 
  scale_fill_continuous()+
  labs(subtitle = "bmi and waist to hip ratio correlation R2 -0.08",
       x = "body mass index",
       y = "waist to hip ratio")+
  geom_smooth(method = "lm") +
  theme_minimal()
  
pl1
``` 

*Plot the relationship between bmi and body fat percentage

```{r}
pl2 <- diabetes_data_t1 %>%
  ggplot(aes(x = bmi, y = body_fat_percentage, fill = bmi)) +
  geom_point(colour = "black", alpha = 0.7, pch = 21)+
  # fill with a continuous colour. 
  scale_fill_continuous()+
  labs( subtitle = "bmi and body fat percentage correlation, R2 0.88",
        x = "body mass index",
        y = "body fat percentage")+
  geom_smooth(method = "lm") +
  theme_minimal()

pl2
``` 
Use patchwork to add the plots together. 

```{r}
pl1 + pl2
```


Is there a certain plot-type, which can visualise if two variables are correlated?
There is a correlogram from GGally. 

```{r}
library(GGally)

# Create the colour palette with grey. 
cbPalette <- c("#999999", "#E69F00")
        
data <- drop_na(diabetes_data_t1) %>% 
  select(bmi, waist_to_hip_ratio, body_fat_percentage)

ggpairs(diabetes_data_t1, columns = c("bmi", "waist_to_hip_ratio", "body_fat_percentage"), 
        mapping = aes(fill = gender),
        
        labs(title="Title: Correlogram",
             subtitle = "ggpairs library"))+
  
        # Change the theme to minimal or wsj
        theme_wsj()+
       
  
        #Add a colour palette for the histograms. 
        #scale_fill_brewer(palette="Spectral")

        scale_fill_manual(values=c(cbPalette))
```

or

```{r}
library(GGally)

# Create the colour palette with grey. 
cbPalette <- c("#999999", "#E69F00")
        
#data <- drop_na(diabetes_data_t1) %>% 
#  select(bmi, waist_to_hip_ratio, body_fat_percentage)

ggpairs(
        data = diabetes_data_t1, 
        
        method = "spearman",
        
        columns = c("bmi", "waist_to_hip_ratio", "body_fat_percentage"), 
        
        mapping = aes(fill = gender, 
                      
                      # change the transparency.
                      alpha = 0.3),

        labs(subtitle="Correlogram of bmi, waist to hip ratio and body fat percentage",
             caption = "Figure 1")) +
  
        # Change the theme to minimal or wsj or clean
        theme_clean()+
       
  
        #Add a colour palette for the histograms. 
        scale_fill_brewer(palette="blues")
        #scale_fill_manual(values=c(cbPalette))
```



```{r}
#library(scales)
#show_col(few_pal()(7))
#"#56B4E9", "#CC6666", "#9999CC", "#66CC99"
```

**T9: For each BMI_class group, calculate the average weight and associated standard deviation**

```{r}
drop_na(diabetes_data_t1) %>% 
  group_by(BMI_class) %>% 
  summarise( average_weight = round(mean(weight_kg), digits = 2),
             assoc_standard_deviation = round(sd(weight_kg), digits = 2))

ungroup(diabetes_data_t1)
```
This makes it easier to see that there is a larger spread of people with morbid obesity in this sample. 
The average weight is 113 kg for those with morbid obesity. 

Now, with this augmented data set, let us create some summary statistics.

Q19: How many women and men are there in the data set?
There are 73 females and 57 males in the dataset.

```{r}
drop_na(diabetes_data_t1) %>% 
  group_by(gender) %>% 
  summarise(n = n())

ungroup(diabetes_data_t1)
```

Q20: How many women and men are there from Buckingham and Louisa respectively in the data set?
There are 26 women and 20 males from Buckingham. There are 47 women and 37 men from Louisa. 

```{r}
drop_na(diabetes_data_t1) %>% 
  group_by(gender, location) %>% 
  summarise(n = n())

ungroup(diabetes_data_t1)
```

Q21: How many are in each of the BMI_class groups?
```{r}
drop_na(diabetes_data_t1) %>% 
  group_by(gender, location, BMI_class) %>% 
  summarise(n = n())

ungroup(diabetes_data_t1)
```

Q22: Given the code below, explain the difference between A and B?
There is not very much difference between the bar chart and the column chart ( apart from the y variable)
```{r}
drop_na(diabetes_data_t1)%>%
  ggplot(aes(x = BMI_class)) +
  geom_bar(colour = "black", fill = viridisLite::viridis(7), alpha = 0.5)+
  theme_excel_new()+
  labs(
    title = "PLOT A"
  )

drop_na(diabetes_data_t1)%>%
  count(BMI_class) %>%
  ggplot(aes(x = BMI_class, y = n)) +
  geom_col(colour = "black", fill = viridisLite::rocket(7), alpha = 0.5)+
  theme_excel_new()+
  labs(
    title = "PLOT B"
  )
```

**Q23: What was the average age of the women living in Buckingham in the study?**
The average age of women in Buckingham is 55. 

```{r}
drop_na(diabetes_data_t1) %>% 
  group_by(gender, location) %>% 
  summarise(average_age = round(mean(age), digits = 0))

ungroup(diabetes_data_t1)
```

**Finally, if you reach this point and there is still time left.**
**Take some time to do some exploratory plots of the data set and see if you can find something interesting.**

```{r}
drop_na(diabetes_data_t1) %>% 
ggplot(
       mapping = aes(x = bmi, y = waist_to_hip_ratio, fill = BMI_class))+
       geom_boxplot(colour = "black", alpha = 0.5, pch = 21)+ 
  
       # wrap based on gender and location. 
      facet_wrap(vars(gender,location))+
  
      # Add a different colour palette. 
      scale_fill_brewer(palette="Accent")+
  
      # Add a theme from ggthemes.
      theme_excel_new()+
  
      # Add some labels. 
      labs(
         title = "The relationship between Waist to Hip Ratio and BMI",
         x = "Body Mass Index",
         y = "Waist to Hip Ratio ",
        caption = "Data from Vanderbilt Biostatistics Datasets",
       )
```
There is one underweight male in Louisa. 
There are normal weight females in Louisa and in Buckingham and no underweight females in either location. 

